---
# The high-level description of your tile.
# Replace these properties with real values.
#
name: ecs-broker-tile # By convention lowercase with dashes
icon_file: resources/icon.png
label: DELL EMC ECS Broker
description: ECS Broker for Pivotal CF
metadata_version: 1.8                 # Optional, defaults to 1.8
rank: 2

# Global defaults (all optional)
#
# org: test-org                         # Name of org to create for your apps
# space: test-space                     # Name of space to create for your apps
# apply_open_security_group: true       # Apply open security group, default: false

# Specify the packages to be included in your tile.
# The format of the section to include depends on the type
# of package you are describing. For fragments of each type
# that you can copy & paste, see:
#
# http://docs.pivotal.io/tiledev/tile-generator.html
#
packages:
- name: ecs_broker
  type: app-broker
  label: ECS Broker Application      # Package name for use in human-readable labels in OpsManager
  manifest:
    path: resources/ecs-cf-service-broker-1.1.0.jar
    buildpack: java_buildpack_offline
    memory: 1G
    env:
      BROKER_REPOSITORY_SERVICE_ID: f3cbab6a-5172-4ff1-a5c7-72990f0ce2aa
      BROKER_REPOSITORY_PLAN_ID: 8e777d49-0a78-4cf4-810a-b5f5173b019d

# Include stemcell criteria if you don't want to accept the default.
# Since this stemcell is only used to run pre and post errands, we
# strongly recommend you leave this alone so that your tile always
# runs with the latest stemcell.
#
# stemcell_criteria:
#   os: ubuntu-trusty
#   requires_cpi: false
#   version: '3062'

# Add properties you want to pass to your applications.
# Properties specified here will not be configurable by the user.
#
properties:
 - name: catalog_services_1_guid
   type: uuid
 - name: catalog_services_2_guid
   type: uuid
 - name: catalog_services_3_guid
   type: uuid
 - name: catalog_services_4_guid
   type: uuid
 - name: catalog_services_5_guid
   type: uuid
#   type: string
#   default: specify a value
#   label: Label for the field on the GUI
#   description: Longer description of the field's purpose

# Uncomment this section if you want to display forms with configurable
# properties in Ops Manager. These properties will be passed to your
# applications as environment variables. You can also refer to them
# elsewhere in this template by using:
#     (( .properties.<property-name> ))
#
forms:
- name: ecs_broker_app
  label: Service Broker Application
  description: Service Broker CF App Configuration Details
  properties:
    - name: app_name
      type: string
      label: Service Broker Application Name
      description: Enter the name for the Service Broker App
      configurable: true
      default: ecs-broker
# TODO: Migrate app_uri to become the app_name
    - name: enable_global_access_to_plans
      label: Enable Global access to all Services and Plans
      description: Open up access to all service plans across all orgs and spaces. If set to false, administrators must use the "enable-service-access" command to allow access
      type: boolean
      configurable: true
      default: true
- name: ecs_connection
  label: Dell EMC ECS Connectivity
  description: Service Broker ECS Connection Details
  properties:
    - name: broker_management_endpoint
      label: ECS Management Endpoint
      description: Enter the URI/endpoint for the ECS HTTPS management API. This is typically accessed from port `4443`, but may be on a different port if accessed through a load balancer
      type: string
      configurable: true
    - name: broker_replication_group
      label: Replication Group
      description: Enter the name of the ECS "replication group" to be used for created buckets. This can be found in the ECS management UI
      type: string
      configurable: true
    - name: broker_namespace
      label: Namespace
      description: Enter the name of the ECS "namespace" to be used for created buckets and users. This can be found in the ECS management UI
      type: string
      configurable: true
    - name: broker_username
      label: ECS Admin Username
      description: Enter the name of the ECS Management API admin user. This should be a namespace admin or system administrator management user on the ECS
      type: string
      configurable: true
    - name: broker_password
      label: ECS Admin Password
      description: Enter the ECS Management API password
      type: string
      configurable: true
    - name: broker_base_url
      label: ECS Base URL
      description: (Optional) Enter the name of the ECS configured base URL, to discover the object endpoint. If not provided, the broker will attempt to discover a default base URL. Alternatively, the URI/endpoint can be specified using the "Object Endpoint" parameter
      type: string
      configurable: true
      optional: true
    - name: certificate_selector
      label: Is the ECS SSL certificate is signed by a trust authority?
      description: If the ECS does not have a properly signed certificate from a trust authority (a self-signed certificate, for example), then customers will need to provide the SSL certificate.
      default: "No"
      configurable: true
      type: selector
      option_templates:
      - name: untrusted_ssl
        select_value: "No"
        property_blueprints:
        - name: broker_certificate
          label: ECS Management Certificate
          description: SSL certificate to enable broker to communicate with ECS API Managment. This is required for self-signed certificates, but may not be needed when the ECS is configured with a signed certificate from a trusted source
          type: text
          configurable: true
          optional: true
      - name: trusted_ssl
        select_value: "Yes"
        property_blueprints: []
    - name: broker_object_endpoint
      label: ECS Object Endpoint
      description: (Optional) Manually specify the URI/endpoint of the ECS S3 API, rather than discover from the ECS configured "base URL". This is typically accessed form port 9020 (HTTP) or port 9021 (HTTPS), but may be on a different port if accessed through a load balancer
      type: string
      configurable: true
      optional: true
- name: broker_service_details
  label: Service Broker Internal Settings
  description: Service Broker Webservice Settings
  properties:
    - name: broker_prefix
      label: Broker Prefix
      description: (Optional) Enter a string used to prefix all broker created buckets and users. Defaults to "ecs-cf-broker-"
      type: string
      configurable: true
      optional: true
    - name: broker_repository_endpoint
      label: Repository Endpoint
      description: (Optional) Enter the URI/endpoint for the ECS S3 API that should be used for storing broker metadata.  Defaults to the object endpoint or base URL
      type: string
      configurable: true
      optional: true
    - name: broker_repository_user
      label: Repository User
      description: (Optional) Enter the name of the user that should be created/used for managing broker metadata. Defaults to "{prefix}-user"
      type: string
      configurable: true
      optional: true
    - name: broker_repository_bucket
      label: Repository Bucket
      description: (Optional) Enter the name of the bucket that should be created/used for managing broker metadata. Defaults to {prefix}-repository
      type: string
      configurable: true
      optional: true
- name: catalog_service_1
  label: Catalog Service 1
  description: Configure Catalog Service 1
  properties:
  - name: catalog_service_1_active
    default: true
    label: Enable Catalog Service 1
    description: If enabled, this service will be included in the broker catalog, which supplies the Cloud Foundry marketplace.
    configurable: true
    type: boolean
  - name: catalog_service_name
    label: Name
    type: string
    configurable: true
    description: Service named used in the Cloud Foundry marketplace. This should be kept fairly short
    default: ecs-bucket
  - name: catalog_service_1_tags
    type: string_list
    label: Tags
    configurable: true
    description: Tags for service. These can be used by applications or cloud services (such as Spring Cloud) to identify service offerings & instances
    default: "s3,bucket"
  - name: catalog_service_1_bindable
    label: Bindable
    type: boolean
    default: true
    configurable: true
    description: Determines if this service can be bound to user applications. This should typically be enabled, but could be disabled for internal-only services
  - name: catalog_service_1_details
    label: Customize catalog presentation
    description: Customize the catalog presentation of a service for customer specific image, descriptions, URL, etc.
    default: "No"
    configurable: true
    type: selector
    option_templates:
    - name: default_service_presentation
      select_value: "No"
      property_blueprints:
      - name: description
        label: Description
        type: string
        configurable: false
        description: Full description of the service appearing in the marketplace
        default: Dell EMC ECS private object storage bucket
      - name: display_name
        default: ECS Bucket
        label: Display Name
        type: string
        configurable: false
        description: The name that will show in the PCF Apps Manager Marketplace
      - name: image_url
        label: Image URL
        type: http_url
        configurable: false
        default: https://avatars.githubusercontent.com/u/12926680
        description: The image that will show in the PCF Apps Manager Marketplace
      - name: long_description
        default: Dell EMC Elastic Cloud Storage (ECS) private object storage Bucket
        type: text
        label: Long Description
        configurable: false
        description: A long description to use for the service, which will show in the PCF Apps Manager Marketplace
      - name: provider_display_name
        label: Provider Display Name
        type: string
        default: Dell EMC
        configurable: false
        description: Provider name that will show in the PCF Apps Manager Marketplace
      - name: documentation_url
        label: Documentation URL
        type: http_url
        configurable: false
        default: https://community.emc.com/docs/DOC-45012
        description: The documentation link that will show in the PCF Apps Manager Marketplace
      - name: support_url
        label: Support URL
        type: http_url
        configurable: false
        default: http://www.emc.com/products-solutions/trial-software-download/ecs.htm
        description: The support link that will show in the PCF Apps Manager Marketplace
    - name: custom_service_presentation
      select_value: "Yes"
      property_blueprints:
      - name: description
        label: Description
        type: string
        configurable: true
        description: Full description of the service appearing in the marketplace
        default: Dell EMC ECS private object storage bucket
      - name: display_name
        default: ECS Bucket
        label: Display Name
        type: string
        configurable: true
        description: The name that will show in the PCF Apps Manager Marketplace
      - name: image_url
        label: Image URL
        type: http_url
        configurable: true
        default: https://avatars.githubusercontent.com/u/12926680
        description: The image that will show in the PCF Apps Manager Marketplace
      - name: long_description
        default: Dell EMC Elastic Cloud Storage (ECS) private object storage Bucket
        type: text
        label: Long Description
        configurable: true
        description: A long description to use for the service, which will show in the PCF Apps Manager Marketplace
      - name: provider_display_name
        label: Provider Display Name
        type: string
        default: Dell EMC
        configurable: true
        description: Provider name that will show in the PCF Apps Manager Marketplace
      - name: documentation_url
        label: Documentation URL
        type: http_url
        configurable: true
        default: https://community.emc.com/docs/DOC-45012
        description: The documentation link that will show in the PCF Apps Manager Marketplace
      - name: support_url
        label: Support URL
        type: http_url
        configurable: true
        default: http://www.emc.com/products-solutions/trial-software-download/ecs.htm
        description: The support link that will show in the PCF Apps Manager Marketplace
  - name: catalog_service_1_service_type_selector
    type: selector
    label: Service Type
    configurable: true
    default: bucket
    description: Set the type of service to be available in the marketplace. A bucket provides a single bucket per service. A namespace provides a tentant "area" where multiple buckets can be provisioned
    option_templates:
    - name: namespace_option
      select_value: namespace
      property_blueprints:
      - name: compliance_enabled
        type: boolean
        label: Enable Compliance
        default: false
        configurable: true
        description: Strongly enforce object retention for compliance. This only applies to namespace services
      - name: default_bucket_quota
        type: integer
        label: Default Bucket Quota (GB)
        optional: true
        configurable: true
        description: Default quota applied to all buckets created within this namespacedefault_bucket_quota. This only applies to namespace services
      - name: encrypted
        label: Enable Encryption
        type: boolean
        default: false
        configurable: true
        description: Enabled encryption on this service. Encryption cannot be changed after creation, so this setting cannot be changed by plan upgrades
    - name: bucket_option
      select_value: bucket
      property_blueprints:
      - name: head_type
        label: Object Head Type
        type: dropdown_select
        default: s3
        configurable: false
        description: Object protocol to use for the provisioned bucket. Today the broker only supports S3, but will support Swift, Atmos & CAS in the future. This only applies to bucket services
        options:
        - name: s3
          label: S3
      - name: repository_service
        type: boolean
        label: Enable as Repository Service
        description: Use this service for the internal metadata of the broker. This should only be enabled for one service, as the broker may pick from repository enabled services at random on startup.
        configurable: true
        default: true
      - name: file_accessible
        label: Enable File Access
        type: boolean
        default: false
        configurable: true
        description: Enable NFS and HDFS access for provisioned buckets. This also enables volume mount services for the service, so a bucket can be used as an application mount point. File access cannot be changed after creation, so this setting cannot be changed by plan upgrades. This only applies to bucket services
      - name: default_retention
        type: integer
        label: Default Retention (Seconds)
        optional: true
        configurable: true
        description: The default object number of seconds an object should be retained. The object cannot be deleted until that time has elapsed. This can be set to -1 for infinite retention. This only applies to bucket services. Setting default retention in the service will _override_ default retention at within a plan.
      - name: encrypted
        label: Enable Encryption
        type: boolean
        default: false
        configurable: true
        description: Enabled encryption on this service. Encryption cannot be changed after creation, so this setting cannot be changed by plan upgrades
  - name: catalog_service_1_plans
    type: collection
    label: Customize Plans for this Service
    configurable: true
    property_blueprints:
    - name: name
      type: string
      label: Name
      configurable: true
      description: Name of this service plan to show in Cloud Foundry marketplace
    - name: description
      type: string
      label: Description
      configurable: true
      description: Description of this service plan to show in Cloud Foundry marketplace
    - name: repository_plan
      type: boolean
      label: Enable as Repository Plan
      description: Use this plan for the internal metadata of the broker. This should only be enabled for one service, as the broker may pick from repository enabled plans at random on startup.
      configurable: true
      description: Description of this service plan to show in Cloud Foundry marketplace
    - name: cost_usd
      type: string
      label: Cost in US Dollars
      configurable: true
      description: The cost for the plan based on the "Cost Unit". Should be in the form of a float -- 0.00
    - name: cost_unit
      type: string
      label: Cost Unit
      configurable: true
      description: The unit for each to charge. By convention is should be in ALL CAPS. Examples include MONTHLY, PER_GB, PER_GB_PER_MONTH
    - name: bullet_1
      type: string
      label: Bullet 1
      configurable: true
      description: Bullet point to show up about the plan in the PCF Marketplace.
      optional: true
    - name: bullet_2
      type: string
      label: Bullet 2
      configurable: true
      description: Bullet point to show up about the plan in the PCF Marketplace.
      optional: true
    - name: bullet_3
      type: string
      label: Bullet 3
      configurable: true
      description: Bullet point to show up about the plan in the PCF Marketplace.
      optional: true
    - name: bullet_4
      type: string
      label: Bullet 4
      configurable: true
      description: Bullet point to show up about the plan in the PCF Marketplace.
      optional: true
    - name: bullet_5
      type: string
      label: Bullet 5
      configurable: true
      description: Bullet point to show up about the plan in the PCF Marketplace.
      optional: true
    - name: quota_limit
      type: integer
      label: Quota Limit (GB)
      optional: true
      configurable: true
      description: The capacity quota limit in gigabytes. A user will not be able to store more than this amount in a provisioned bucket or namespace
    - name: quota_warn
      type: integer
      label: Quota Warning (GB)
      optional: true
      configurable: true
      description: The capacity quota warning in gigabytes. A ECS warning notification will be generated when a user consumes this amount of storage
    - name: free
      type: boolean
      label: Free of Charge
      configurable: true
      description: Whether this service is free or paid
    - name: access_during_outage
      label: Enable Access During Outage
      type: boolean
      default: true
      configurable: true
      description: This allows a bucket or namespace to remain online even if the primary site is offline. This is typically enabled, but can be disabled if strict data consistency is required, since actual replication is asynchronous
    - name: default_retention
      type: integer
      label: Default Retention (Seconds)
      optional: true
      configurable: true
      description: The default object number of seconds an object should be retained. The object cannot be deleted until that time has elapsed. This can be set to -1 for infinite retention. This only applies to bucket services
    default:
    - name: 5gb
      description: 5 GB free trial
      cost_usd: 0.00
      cost_unit: MONTHLY
      quota_limit: 5
      quota_warn: 4
      free: true
      bullet_1: Shared Object Storage
      bullet_2: 5 GB Storage Limit
      bullet_3: S3 Protocol Access
    - name: unlimited
      repository_plan: true
      description: Usage based billing
      cost_usd: 0.03
      cost_unit: PER_GB_PER_MONTH
      bullet_1: Shared Object Storage
      bullet_2: Unlimited Storage
      bullet_3: S3 Protocol Access

# If prior versions of your tile are installed and configured, their
# property values will not be overwritten by new defaults provided
# in this file. If that is your intent, you must do the overwriting
# explicitly using JavaScript migration functions, like so:
#
# migration: |
#   properties['properties']['.properties.org']['value'] = 'system';
